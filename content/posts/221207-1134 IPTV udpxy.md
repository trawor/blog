---
title: RouterOS IPTV udpxy
date: 2022-12-07
showFullContent: false
readingTime: true
cover: 
tags:
  - 开发
  - Homelab
  - RouterOS
keywords:
  - iptv
  - udpxy
description: 全内网看IPTV, 包括小米路由器和RouterOS
slug: iptv
---


## 小米路由器直接开启
小米AX3600每路视频大概占用不到1%的CPU, 很轻松

#### 下载 

- AX3600
https://mirrors.aliyun.com/openwrt/releases/18.06-SNAPSHOT/packages/aarch64_cortex-a53/packages/udpxy_2016-09-18-53e4672a7522311c40e9f6110ff256041c52c8b4-1_aarch64_cortex-a53.ipk

下载后改后缀名为zip然后解压缩, 找到`data/usr/bin/`文件夹内的`udpxy` 通过scp传到小米路由器上,
本文传到了 /data/
```
scp -O data/usr/bin/udpxy root@路由器IP:/data/
```

然后ssh到小米路由器进行下面的配置.

#### 配置

1. 赋予可执行权限 `chmod +x /data/udpxy`

2. 修改防火墙 `/etc/config/firewall`

```
config rule                                                                   
        option src 'wan'                                                      
        option proto 'udp'                                                    
        option dest_ip '224.0.0.0/4'                                          
        option target 'ACCEPT'                                                
        option name 'Allow-UDP-udpxy'

config rule
        option src 'wan'
        option proto 'igmp'
        option target 'ACCEPT'
        option name 'Allow-IGMP-udpxy'
```

3. 修改开机启动`/etc/rc.local` 添加
```
/data/udpxy -p 4022 -m eth1 -B 2097152 -R 10 -M 300
```


测试一下:
1. 重新加载防火墙 `/etc/init.d/firewall reload`
2. `/data/udpxy -p 4022`
3. 打开 http://路由器IP:4022/status 看看是否显示正常
4. 用VLC等打开  http://路由器IP:4022/rtp/239.3.1.129:8008 (北京联通的, 其它地区自己替换)


## RouterOS 用容器开启

```sh
#创建一个虚拟网卡,并且桥接到光猫线路
/interface/veth/add name=udpxy-veth address=192.168.1.200/24 gateway=192.168.1.1
/interface/bridge/port add bridge=WAN interface=udpxy-veth
#创建容器,镜像只有6M的soff/udpxy
/container/add remote-image=soff/udpxy:latest interface=udpxy-veth hostname=udpxy logging=yes start-on-boot=yes
```

然后打开`http://192.168.1.200:4002/status`就能看到udpxy的运行状态了. 

2路视频的CPU大概4%左右, 毫无压力:
![](assets/images/iptv.png)


附上北京联通 IPTV M3U文件(不全,我自己挑选了几个, 更多的可以直接自己添加):
```ini
#EXTM3U url-tvg="https://iptv-org.github.io/epg/guides/cn/tv.cctv.com.epg.xml.gz,http://epg.51zmt.top:8000/e.xml,https://iptv-org.github.io/epg/guides/hk-zh/nowplayer.now.com.epg.xml.gz,https://iptv-org.github.io/epg/guides/us/tvtv.us.epg.xml.gz" x-tvg-url="https://iptv-org.github.io/epg/guides/cn/tv.cctv.com.epg.xml.gz,http://epg.51zmt.top:8000/e.xml,https://iptv-org.github.io/epg/guides/hk-zh/nowplayer.now.com.epg.xml.gz"

#EXTINF:-1 tvg-id="4" tvg-id="BRTVNewsChannel.cn" tvg-logo="http://epg.51zmt.top:8000/tb1/sheng/BTV%E6%96%B0%E9%97%BB.png" tvg-name="BTV新闻" group-title="北京",BTV新闻
http://192.168.1.200:4022/rtp/239.3.1.159:8000
#EXTINF:-1 tvg-id="30" tvg-name="北京卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/beijing.png" group-title="卫视",BTV北京卫视
http://192.168.1.200:4022/rtp/239.3.1.241:8000
#EXTINF:-1 tvg-id="1873" tvg-name="BTV文艺" tvg-logo="http://epg.51zmt.top:8000/tb1/sheng/BTV文艺.png" group-title="北京",BTV文艺
http://192.168.1.200:4022/rtp/239.3.1.242:8000
#EXTINF:-1 tvg-id="1875" tvg-name="BTV影视" tvg-logo="http://epg.51zmt.top:8000/tb1/sheng/BTV影视.png" group-title="北京",BTV影视
http://192.168.1.200:4022/rtp/239.3.1.158:8000

#EXTINF:-1 tvg-id="1" tvg-name="CCTV1" tvg-logo="http://epg.51zmt.top:8000/tb1/CCTV/CCTV1.png" group-title="央视",CCTV-1
http://192.168.1.200:4022/rtp/239.3.1.129:8008

#EXTINF:-1 tvg-id="5" tvg-name="CCTV5" tvg-logo="http://epg.51zmt.top:8000/tb1/CCTV/CCTV5.png" group-title="央视",CCTV-5
http://192.168.1.200:4022/rtp/239.3.1.173:8001

#EXTINF:-1 tvg-id="12" tvg-name="CCTV12" tvg-logo="http://epg.51zmt.top:8000/tb1/CCTV/CCTV12.png" group-title="央视",CCTV-12
http://192.168.1.200:4022/rtp/239.2.1.64:8124

#EXTINF:-1 tvg-id="13" tvg-name="CCTV13" tvg-logo="http://epg.51zmt.top:8000/tb1/CCTV/CCTV13.png" group-title="央视",CCTV-13
http://192.168.1.200:4022/rtp/239.2.1.13:8048

#EXTINF:-1 tvg-id="14" tvg-name="CCTV13" tvg-logo="http://epg.51zmt.top:8000/tb1/CCTV/CCTV13.png" group-title="央视",CCTV-13高清
http://192.168.1.200:4022/rtp/239.3.1.124:8128


#EXTINF:-1 tvg-id="CCTV5Plus.cn" tvg-country="CN" tvg-logo="http://epg.51zmt.top:8000/tb1/CCTV/CCTV5+.png" group-title="央视",CCTV-5+体育赛事
http://192.168.1.200:4022/rtp/239.3.1.130:8004

#EXTINF:-1 tvg-id="39" tvg-name="天津卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/tianjin.png" group-title="卫视",天津卫视
http://192.168.1.200:4022/rtp/239.3.1.141:1234
#EXTINF:-1 tvg-id="27" tvg-name="湖南卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/hunan.png" group-title="卫视",湖南卫视
http://192.168.1.200:4022/rtp/239.3.1.132:8012
#EXTINF:-1 tvg-id="46" tvg-name="黑龙江卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/heilongjiang.png" group-title="卫视",黑龙江卫视
http://192.168.1.200:4022/rtp/239.3.1.133:8016
#EXTINF:-1 tvg-id="34" tvg-name="深圳卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/shenzhen.png" group-title="卫视",深圳卫视
http://192.168.1.200:4022/rtp/239.3.1.134:8020
#EXTINF:-1 tvg-id="29" tvg-name="江苏卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/jiangsu.png" group-title="卫视",江苏卫视
http://192.168.1.200:4022/rtp/239.3.1.135:8028
#EXTINF:-1 tvg-id="31" tvg-name="东方卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/dongfang.png" group-title="卫视",东方卫视
http://192.168.1.200:4022/rtp/239.3.1.136:8032
#EXTINF:-1 tvg-id="28" tvg-name="浙江卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/zhejiang.png" group-title="卫视",浙江卫视
http://192.168.1.200:4022/rtp/239.3.1.137:8036
#EXTINF:-1 tvg-id="48" tvg-name="湖北卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/hubei.png" group-title="卫视",湖北卫视
http://192.168.1.200:4022/rtp/239.3.1.138:8044
#EXTINF:-1 tvg-id="38" tvg-name="山东卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/shandong.png" group-title="卫视",山东卫视
http://192.168.1.200:4022/rtp/239.3.1.209:8052
#EXTINF:-1 tvg-id="36" tvg-name="辽宁卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/liaoning.png" group-title="卫视",辽宁卫视
http://192.168.1.200:4022/rtp/239.3.1.210:8056
#EXTINF:-1 tvg-id="32" tvg-name="安徽卫视" tvg-logo="http://epg.51zmt.top:8000/tb1/ws/anhui.png" group-title="卫视",安徽卫视
http://192.168.1.200:4022/rtp/239.3.1.211:8064

```

